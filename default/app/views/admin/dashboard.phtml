<h1><?= $title ?></h1>
<div class="row">
    <!-- Card: Reportes -->
    <div class="col-md-4 col-sm-6 mb-4">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="mb-2 text-white-50">Total Reportes</h6>
                        <h2 class="mb-0 text-white"><?= $total_reportes ?></h2>
                        <small class="text-white-50">
                            Pendientes: <?= $reportes_pendientes ?> | Atendidos: <?= $reportes_atendidos ?>
                        </small>
                    </div>
                    <div class="avtar bg-white text-primary">
                        <i class="ti ti-report" style="font-size: 2rem;"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <?= Bform::btn_gestionar('reportes/admin', 'Gestionar Reportes') ?>
                </div>
            </div>
        </div>
    </div>

    <!-- Card: Usuarios -->
    <div class="col-md-4 col-sm-6 mb-4">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="mb-2 text-white-50">Total Usuarios</h6>
                        <h2 class="mb-0 text-white"><?= $total_usuarios ?></h2>
                        <small class="text-white-50">Sistema de gestión</small>
                    </div>
                    <div class="avtar bg-white text-success">
                        <i class="ti ti-users" style="font-size: 2rem;"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <?= Bform::btn_gestionar('usuarios', 'Gestionar Usuarios') ?>
                </div>
            </div>
        </div>
    </div>

    <!-- Card: Comentarios -->
    <div class="col-md-4 col-sm-6 mb-4">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="mb-2 text-white-50">Total Comentarios</h6>
                        <h2 class="mb-0 text-white"><?= $total_comentarios ?></h2>
                        <small class="text-white-50">En todos los reportes</small>
                    </div>
                    <div class="avtar bg-white text-warning">
                        <i class="ti ti-message" style="font-size: 2rem;"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <?= Bform::btn_gestionar('comentarios', 'Gestionar Comentarios') ?>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Reportes por Estado -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="ti ti-list-check me-2"></i>Reportes por Estado</h5>
            </div>
            <div class="card-body">
                <?php
                $total_para_porcentaje = $total_reportes > 0 ? $total_reportes : 1;
                foreach ($reportes_por_estado as $id => $data):
                    $porcentaje = round(($data['total'] / $total_para_porcentaje) * 100);
                    $color = $id == 1 ? 'primary' : ($id == 2 ? 'warning' : 'success');
                    ?>
                    <div class="row align-items-center my-2">
                        <div class="col-5">
                            <p class="mb-0"><?= $data['nombre'] ?></p>
                        </div>
                        <div class="col">
                            <div class="progress progress-<?= $color ?>">
                                <div class="progress-bar" style="width: <?= $porcentaje ?>%"></div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <p class="mb-0 text-sm text-muted"><?= $data['total'] ?> (<?= $porcentaje ?>%)</p>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>
    </div>

    <!-- Reportes por Prioridad -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="ti ti-urgent me-2"></i>Reportes por Prioridad</h5>
            </div>
            <div class="card-body">
                <?php
                foreach ($reportes_por_prioridad as $id => $data):
                    $porcentaje = round(($data['total'] / $total_para_porcentaje) * 100);
                    $color = $id == 1 ? 'success' : ($id == 2 ? 'warning' : 'danger');
                    ?>
                    <div class="row align-items-center my-2">
                        <div class="col-5">
                            <p class="mb-0"><?= $data['nombre'] ?></p>
                        </div>
                        <div class="col">
                            <div class="progress progress-<?= $color ?>">
                                <div class="progress-bar" style="width: <?= $porcentaje ?>%"></div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <p class="mb-0 text-sm text-muted"><?= $data['total'] ?> (<?= $porcentaje ?>%)</p>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>
    </div>
</div>

<!-- Últimos Reportes -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="ti ti-clock me-2"></i>Últimos Reportes</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover table-sm">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Título</th>
                                <th>Estado</th>
                                <th>Prioridad</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach ($ultimos_reportes as $r): ?>
                                <tr>
                                    <td><?= $r->id ?></td>
                                    <td><?= $r->titulo ?></td>
                                    <td><?= Bform::badge_estado($r->getEstados()) ?></td>
                                    <td><?= Bform::badge_prioridad($r->getPrioridades()) ?></td>
                                    <td>
                                        <small><?= date('d/m/Y', strtotime($r->created_at)) ?></small>
                                    </td>
                                    <td>
                                        <a href="<?= PUBLIC_PATH ?>reportes/ver/<?= $r->id ?>"
                                            class="btn btn-sm btn-light-info" title="Ver">
                                            <i class="ti ti-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>