<h1><?= $title ?></h1>
<div class="row">
    <div class="col-sm-12">
        <div class="card">
            <div class="card-header">
                <h5><?= $subtitle ?></h5>
            </div>
            <div class="card-body">
                <?= Bform::btn_agregar("reportes/registrar", "Realizar Reporte") ?>
                <br><br>

                <!-- Tabla -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Dirección</th>
                                <th>Fecha</th>
                                <th>Tags</th>
                                <th class="text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php if (count($reportes) > 0): ?>
                                <?php foreach ($reportes as $r): ?>
                                    <tr>
                                        <td>
                                            <strong><?= $r->titulo ?></strong>
                                        </td>
                                        <td><?= substr($r->direccion, 0, 50) ?>...</td>
                                        <td>
                                            <small class="text-muted">
                                                <?= date('d/m/Y', strtotime($r->created_at)) ?>
                                            </small>
                                        </td>
                                        <td>
                                            <!-- Tags -->
                                            <?= Bform::badge_estado($r->getEstados()) ?>
                                            <?= Bform::badge_prioridad($r->getPrioridades()) ?>
                                            <span class="badge bg-light-warning">
                                                <i class="ti ti-ruler-2"></i> <?= $r->diametro ?> cm
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <!-- Botones -->

                                            <a href="<?= PUBLIC_PATH ?>reportes/ver/<?= $r->id ?>"
                                                class="btn btn-sm btn-light-info" title="Ver">
                                                <i class="ti ti-eye"></i>
                                            </a>
                                            <a href="<?= PUBLIC_PATH ?>reportes/editar/<?= $r->id ?>"
                                                class="btn btn-sm btn-light-warning" title="Editar">
                                                <i class="ti ti-edit"></i>
                                            </a>
                                            <button onclick="confirmarEliminar(<?= $r->id ?>, '<?= addslashes($r->titulo) ?>')"
                                                class="btn btn-sm btn-light-danger" title="Eliminar">
                                                <i class="ti ti-trash"></i>
                                            </button>

                                        </td>
                                    </tr>
                                <?php endforeach; ?>
                            <?php else: ?>
                                <tr>
                                    <td colspan="5" class="text-center text-muted">
                                        <i class="ti ti-folder-off" style="font-size: 3rem;"></i>
                                        <p>No tienes reportes aún. ¡Crea tu primer reporte!</p>
                                    </td>
                                </tr>
                            <?php endif; ?>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function confirmarEliminar(id, titulo) {
        if (confirm('¿Estás seguro de que deseas eliminar el reporte "' + titulo + '"?\n\nEsta acción no se puede deshacer.')) {
            window.location.href = '<?= PUBLIC_PATH ?>reportes/eliminar/' + id;
        }
    }
</script>